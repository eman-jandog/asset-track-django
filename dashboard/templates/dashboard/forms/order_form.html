            {% load crispy_forms_tags %} 
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">{% if order %}Update Order{% else %}Create New Order{% endif %}</h3>
                        <button id="closeOrderModal" onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <form id="createOrderForm" class="p-6 space-y-6" {% if order %}action="{% url 'orders-action' pk=order.pk|default:'' %}"{% else %}action="{% url 'orders-create' %}"{% endif %} data-form="orders">
                    {% crispy form %}
                    
                    <div class="border-t pt-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-gray-800">Order Items</h4>
                            <button type="button" id="addOrderItem" class="bg-green-100 text-green-700 px-3 py-2 rounded-lg hover:bg-green-200 transition-colors text-sm flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>Add Item</span>
                            </button>
                        </div>
                        
                        <div id="orderItemsContainer" oninput="updateTotal()" class="space-y-4">
                            {{ formset.management_form }}
                            {% for item_form in formset %}
                            <div class="order-item grid grid-cols-1 md:grid-cols-5 gap-4 p-4 bg-gray-50 rounded-lg">
                                {% crispy item_form %}
                                <div class="flex items-end mb-3">
                                    <button type="button" class="remove-item w-full bg-red-100 text-red-700 px-3 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm">Remove</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-semibold text-gray-800">Estimated Total:</span>
                                <span id="orderTotal" class="text-xl font-bold text-blue-600">â‚±0.00</span>
                            </div>
                        </div>
                    </div>
                   
                    <div class="flex justify-end space-x-4 pt-6 border-t">
                        <button type="button" id="cancelOrderModal" onclick="closeModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                        <button type="submit" id='submitBtn' class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">{% if order %}Update Order{% else %}Create Order{% endif %}</button>
                    </div>
                </form>
            </div>